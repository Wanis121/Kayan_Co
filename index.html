<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kayan Co</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',Tahoma,Arial;}
body{background:#0f172a;color:#fff;transition:.3s;}
body.light{background:#f1f5f9;color:#0f172a;}
.login-box{position:fixed;inset:0;background:linear-gradient(135deg,#0f172a,#1e293b);display:flex;align-items:center;justify-content:center;z-index:9999;}
.login-card{background:rgba(255,255,255,0.08);backdrop-filter:blur(18px);padding:25px;border-radius:18px;width:100%;max-width:350px;text-align:center;box-shadow:0 10px 40px rgba(0,0,0,0.3);}
.login-card h2{margin-bottom:15px;font-weight:600}
.login-card input{width:100%;margin:10px 0;padding:12px;border-radius:12px;border:none;font-size:16px;}
.login-card button{width:100%;padding:12px;background:#22c55e;color:#fff;border:none;border-radius:12px;font-size:17px;cursor:pointer;}
.error{color:#f87171;font-size:14px;margin-top:5px;}
#lockMsg{color:#fb7185;font-size:14px;margin-top:8px;}
.header{display:flex;justify-content:space-between;align-items:center;padding:10px 15px;}
#themeBtn{font-size:22px;background:none;border:none;cursor:pointer;}
.container{padding:10px;max-width:600px;margin:auto;}
.card{background:rgba(255,255,255,0.08);padding:12px;border-radius:16px;margin-bottom:12px;}
body.light .card{background:#fff;box-shadow:0 4px 15px rgba(0,0,0,0.1);}
.title{font-size:18px;margin-bottom:5px;font-weight:600;}
table{width:100%;border-collapse:collapse;}
td{padding:6px;}
input{width:100%;padding:8px;border-radius:10px;border:none;}
.add-btn{background:#22c55e;border:none;color:#fff;padding:8px 14px;border-radius:12px;margin-top:5px;cursor:pointer;}
.delete-btn{background:#ef4444;border:none;color:#fff;padding:6px 10px;border-radius:10px;cursor:pointer;}
#adminPanel{display:none;background:#00000066;backdrop-filter:blur(20px);border-radius:20px;padding:15px;margin-top:10px;}
textarea{width:100%;height:150px;border-radius:12px;padding:10px;display:none;}
</style>
</head>
<body>

<!-- LOGIN -->
<div class="login-box" id="loginBox">
  <div class="login-card">
    <h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
    <input id="user" placeholder="Username">
    <input id="pass" type="password" placeholder="Password">
    <button onclick="login()">Ø¯Ø®ÙˆÙ„</button>
    <div class="error" id="loginError"></div>
    <div id="lockMsg"></div>
  </div>
</div>

<!-- MAIN APP -->
<div class="header">
  <h3>Kayan Co</h3>
  <button id="themeBtn" onclick="toggleTheme()">ğŸŒ™</button>
  <button class="add-btn" onclick="logout()">â‹ ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
</div>

<div class="container">
<input placeholder="Ø¨Ø­Ø«..." oninput="globalSearch(this.value)">

<div class="card">
  <div class="title">Ù…Ø³ØªÙ„Ø²Ù…Ø§Øª Ø§Ù„Ø£Ø·Ø¨Ø§Ø¡</div>
  <table id="doctorTable"></table>
  <button class="add-btn" onclick="addItem('doctor')">Ø¥Ø¶Ø§ÙØ©</button>
</div>

<div class="card">
  <div class="title">Ù…Ø³ØªÙ„Ø²Ù…Ø§Øª Ø§Ù„ØµØ§Ù„ÙˆÙ†Ø§Øª</div>
  <table id="salonTable"></table>
  <button class="add-btn" onclick="addItem('salon')">Ø¥Ø¶Ø§ÙØ©</button>
</div>

<div class="card">
  <div class="title">Ù…Ø³ØªÙ„Ø²Ù…Ø§Øª Ø§Ù„Ù…Ø·Ø§Ø¹Ù…</div>
  <table id="restaurantTable"></table>
  <button class="add-btn" onclick="addItem('restaurant')">Ø¥Ø¶Ø§ÙØ©</button>
</div>

<div class="card">
  <div class="title">Ù…Ø³ØªÙ„Ø²Ù…Ø§Øª Ø§Ù„Ù…Ø¹Ø§Ù…Ù„</div>
  <table id="labsTable"></table>
  <button class="add-btn" onclick="addItem('labs')">Ø¥Ø¶Ø§ÙØ©</button>
</div>

<!-- SECRET PANEL -->
<div id="adminPanel">
  <h3>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø³Ø±ÙŠØ©</h3>

  <!-- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† -->
  <div class="card">
    <h4>Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯</h4>
    <input id="newUser" placeholder="Username">
    <input id="newPass" type="password" placeholder="Password">
    <input id="confirmPass" type="password" placeholder="Confirm Password">
    <button class="add-btn" onclick="addNewUser()">â• Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù…</button>
  </div>

  <!-- Ø¨ÙŠØ§Ù†Ø§Øª -->
  <button class="add-btn" onclick="exportData()">ğŸ“¤ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
  <button class="add-btn" onclick="copyData()">ğŸ“‹ Ù†Ø³Ø® Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
  <button class="add-btn" onclick="undo()">â†© Ø±Ø¬ÙˆØ¹ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³Ø§Ø¨Ù‚</button>
  <button class="add-btn" onclick="showLogs()">ğŸ“œ Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¬Ù„</button>
  
  <textarea id="exportBox"></textarea>
</div>

<script>
/* ===== Users ===== */
const USERS=[
  {u:"kareem m",p:"Kareem123"},
  {u:"wanis s",p:"kajo1234"}
];
const DATA_KEY="kayan_data";
const LOG_KEY="kayan_logs";
const HISTORY_KEY="kayan_history";
const LOGIN_KEY="kayan_last_login";

let data=JSON.parse(localStorage.getItem(DATA_KEY))||{doctor:[],salon:[],restaurant:[],labs:[]};
let logs=JSON.parse(localStorage.getItem(LOG_KEY))||[];
let history=JSON.parse(localStorage.getItem(HISTORY_KEY))||[];

let tries=0;

/* ===== Login Function ===== */
function login(){
  const userInput=document.getElementById("user").value.trim();
  const passInput=document.getElementById("pass").value;
  const now=Date.now();
  const blockedUntil=localStorage.getItem("blockedUntil")||0;

  if(now<blockedUntil){
    document.getElementById("lockMsg").textContent="â›” Ù…Ù‚ÙÙˆÙ„ Ù…Ø¤Ù‚ØªÙ‹Ø§ØŒ Ø­Ø§ÙˆÙ„ Ø¨Ø¹Ø¯ Ø¯Ù‚ÙŠÙ‚Ø©";
    return;
  }

  const ok=USERS.find(x=>x.u===userInput && x.p===passInput);
  if(ok){
    document.getElementById("loginBox").style.display="none";
    localStorage.setItem("loggedIn", userInput);
    localStorage.setItem(LOGIN_KEY,new Date().toLocaleString());
  }else{
    tries++;
    document.getElementById("loginError").textContent="âŒ Ø¨ÙŠØ§Ù†Ø§Øª Ø®Ø§Ø·Ø¦Ø©";
    if(tries>=3){
      localStorage.setItem("blockedUntil", now+60000);
      document.getElementById("lockMsg").textContent="â›” ØªÙ… ØºÙ„Ù‚ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù…Ø¯Ø© Ø¯Ù‚ÙŠÙ‚Ø©";
      tries=0;
    }
  }
}

/* ===== Logout ===== */
function logout(){
  localStorage.removeItem("loggedIn");
  location.reload();
}

/* ===== Data + Logs + Undo ===== */
function save(action){
  history.push(JSON.stringify(data));
  if(history.length>20) history.shift();
  localStorage.setItem(HISTORY_KEY,JSON.stringify(history));
  localStorage.setItem(DATA_KEY,JSON.stringify(data));
  logs.push({action,time:new Date().toLocaleString()});
  localStorage.setItem(LOG_KEY,JSON.stringify(logs));
}

function undo(){
  if(!history.length){alert("Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªØ¹Ø¯ÙŠÙ„Ø§Øª"); return;}
  data=JSON.parse(history.pop());
  localStorage.setItem(HISTORY_KEY,JSON.stringify(history));
  renderAll();
}

/* ===== Render ===== */
function render(section){
  let t=document.getElementById(section+"Table");
  t.innerHTML="";
  data[section].forEach((x,i)=>{
    t.innerHTML+=`<tr>
      <td><input value="${x.name}" oninput="data.${section}[${i}].name=this.value;save('edit')"></td>
      <td><input value="${x.price}" oninput="data.${section}[${i}].price=this.value;save('edit')"></td>
      <td><button class="delete-btn" onclick="delItem('${section}',${i})">Ã—</button></td>
    </tr>`;
  });
}
function renderAll(){["doctor","salon","restaurant","labs"].forEach(render)}
function addItem(section){data[section].push({name:"",price:""});save('add');render(section);}
function delItem(section,i){if(confirm("Ø­Ø°ÙØŸ")){data[section].splice(i,1);save('delete');render(section);}}

/* ===== Secret Panel Functions ===== */
function addNewUser(){
  const u=document.getElementById("newUser").value.trim();
  const p=document.getElementById("newPass").value;
  const c=document.getElementById("confirmPass").value;
  if(!u||!p){alert("Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±");return;}
  if(p!==c){alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙˆØ§Ù„ØªØ£ÙƒÙŠØ¯ ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚ÙŠÙ†");return;}
  USERS.push({u,p});
  logs.push({action:`Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù…: ${u}`,time:new Date().toLocaleString()});
  localStorage.setItem(LOG_KEY,JSON.stringify(logs));
  alert("âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­");
  document.getElementById("newUser").value="";
  document.getElementById("newPass").value="";
  document.getElementById("confirmPass").value="";
}

/* ===== Export & Copy & Logs ===== */
function exportData(){
  const b=document.getElementById("exportBox");
  b.style.display="block";
  b.value=JSON.stringify(data,null,2);
}
function copyData(){
  const b=document.getElementById("exportBox");
  if(!b.value){alert("Ø§Ø³ØªØ®Ø±Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø£ÙˆÙ„Ø§Ù‹");return;}
  navigator.clipboard.writeText(b.value);
  alert("âœ… ØªÙ… Ø§Ù„Ù†Ø³Ø®");
}
function showLogs(){
  const b=document.getElementById("exportBox");
  b.style.display="block";
  b.value=logs.map(l=>`${l.time} - ${l.action}`).join("\n");
}

/* ===== Search + Secret ===== */
function globalSearch(v){if(v==="kajo0000")document.getElementById("adminPanel").style.display="block";}

/* ===== Theme ===== */
function toggleTheme(){
  document.body.classList.toggle("light");
  localStorage.setItem("theme",document.body.className);
  themeBtn.textContent=document.body.classList.contains("light")?"ğŸŒ":"ğŸŒ™";
}

/* ===== Init ===== */
(function init(){
  const logged=localStorage.getItem("loggedIn");
  const th=localStorage.getItem("theme");
  if(th)document.body.className=th;
  if(logged){document.getElementById("loginBox").style.display="none";}
  renderAll();
})();
</script>

</body>
</html>
